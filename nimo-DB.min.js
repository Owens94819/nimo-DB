function NimoDB(){function parsekey(key){return key="number"==typeof key||key instanceof Number?`number:${Number(key)}`:`string:${String(key)}`}Object.observe=Object.observe||function(obj,f){},Object.assign=Object.assign||function(p,c){for(var d in c)p[d]=c[d];return p},parsekey.decode=function(key){var type=key.substring(0,key.indexOf(":"));return type=(type=type.charAt(0).toUpperCase()+type.substring(1)).trim()||"String",key=key.substring(key.indexOf(":")+1),type in Window==!1&&(type="String"),key=window[type](key)};var attr={},SynID="Sync storage",done="done",SynNAME=location.href,keyPath="NIMO_DB_ID",def="records",_name=keyPath,tmp="[hyper database 2003]",_this=this;this.Sync=function(){for(var id,foo=new Function,config={cache:!0,typeSensitive:!0,accept:["array","object","number","string"]},i=0;arguments.length>i;i++){var ty=arguments[i]?typeof arguments[i]:null;"string"===ty||arguments[i]instanceof String?id=arguments[i]:"object"===ty?(arguments[i].__proto__=config,config=arguments[i],config.settled=!0):"function"===ty&&(foo=arguments[i])}id===SynID&&NimoDB.__proto__.console.error(`"${id}" is already taken for our prototype`),("string"!=typeof id&&id instanceof String==!1||!id.trim())&&(id=SynID),id=id.trim();var db=NimoDB.store[id]=NimoDB.store[id]||{};db.Syncdata=db.Syncdata||[],db.config=db.config||config,db.data=db.data||{},db.keys=db.keys||[],db.dataAsArray=db.dataAsArray||[],db.SyncResolving=db.SyncResolving||0,db.opening=db.opening||0,"cache"in db.config==!1&&(db.config.cache=!0),db.obj=db.obj||{ready:new Promise((function(r){db.SyncResolver=r}))};var obj=db.obj,p=function(exec,promise,parent,argument,foo){if(db.config.filter&&db.config.filter instanceof Function&&"function"==typeof db.config.filter){var filter=new db.config.filter(argument);for(var key in filter)if(key.toLowerCase()===String(argument._name).toLowerCase()){filter=filter[key]();break}if(!filter)return}return foo&&(exec=foo("string"==typeof argument[0]&&db.config.typeSensitive?parsekey(argument[0]):argument[0],argument[1],argument[2])),promise=promise||new Promise((function(r){db.Syncdata.push({readyMode:parent.__ready__,name:argument[0],value:argument[1],type:argument._name,r:r,exec:parseString(exec)})})),parent.__proto__.__ready__?("string"==typeof exec&&exec.eval&&(exec=eval(String(exec))),db.data.__proto__.length=db.keys.length,exec):promise},push=function(val,c){var name=val.name,value=val.value;if("string"==typeof val.exec&&val.exec.eval&&(val.exec=eval(String(val.exec))),db.config.cache?((val.type.includes("get")||val.type.includes("key"))&&val.readyMode||db.items[val.type](name,value),val.r(val.exec)):db.items[val.type](name,value).then(val.r),val.type=val.type.toLowerCase(),db.Events[val.type]instanceof Array)for(var i=0;i<db.Events[val.type].length;i++)try{db.Events[val.type][i](name)}catch(error){}else db.Events[val.type]=[]},then=function(e){e=attr.row.init(e),db.SyncResolving>1||(db.SyncResolving+=1,db.items=e,db.config.cache?e.getAllItem((function(key,value){db.config.typeSensitive&&(key=parsekey(key)),db.data[key]=value.value,db.keys.push(key)})).then((function(data){db.data.__proto__.length=db.keys.length,push.resolve()})):push.resolve())},parseString=function(e,v){return v=v||";","string"!=typeof e||e.eval||(e=e.substring(e.lastIndexOf(v)+1)),e};push.resolve=function(){for(var val of db.Syncdata)push(val);db.config.cache&&(db.SyncResolved||db.SyncResolver(nonPromise)),foo(nonPromise),db.Syncdata=[],db.Syncdata.push=push,db.SyncResolved=!0},obj.parsekey=parsekey.decode,obj.setItem=function setItem(){var type=arguments.callee.name||"setItem";return arguments._name=type,p(null,null,this,arguments,(function(name,value,s){return db.config.cache&&(name in db.data!=!1&&!0!==s||db.keys.push(name),s||(db.data[name]=value)),done}))},obj.getItem=function getItem(){var type=arguments.callee.name||"getItem";return arguments._name=type,p(null,null,this,arguments,(function(name){return db.data[name]}))},obj.removeItem=function removeItem(){var type=arguments.callee.name||"removeItem";return arguments._name=type,p(null,null,this,arguments,(function(name){return db.config.cache&&(delete db.data[name],db.keys=Object.keys(db.data)),done}))},obj.clear=function clear(){var type=arguments.callee.name||"clear";return arguments._name=type,p(null,null,this,arguments,(function(){if(db.config.cache){for(var i=0;i<db.keys.length;i++)delete db.data[db.keys[i]];db.keys=Object.keys(db.data)}return done}))},obj.getAllItem=function getAllItem(){var type=arguments.callee.name||"getAllItem";return arguments._name=type,p(null,null,this,arguments,(function(){return db.data}))},obj.keys=function keys(){var type=arguments.callee.name||"keys";return arguments._name=type,p(null,null,this,arguments,(function(){return db.keys}))},obj.has=function has(){var type=arguments.callee.name||"has";return arguments._name=type,p(null,null,this,arguments,(function(name){return name in db.data}))},obj.on=function(name,foo){name=String(name).toLowerCase(),foo instanceof Function&&"function"==typeof foo&&(db.Events[name]?db.Events[name][db.Events[name].length]=foo:db.Events[name]=[foo])};var observer={add:function(name,value){obj.setItem(name,value,!0)},delete:obj.removeItem};observer.update=obj.setItem;var nonPromise=db.data;return nonPromise.__proto__={},nonPromise.__proto__.__ready__=!0,nonPromise.__proto__.__proto__=obj,Object.freeze(obj),db.SyncResolving>0&&config.settled&&NimoDB.__proto__.console.error(`${JSON.stringify(config)}\n-Above Object will be overwrite, for the returned values are instance of the previous initialized values for "${id}"`),db.items?push.resolve():db.SyncResolving<1&&(Object.assign(db.config,config),arguments.callee.stable(id,db,then),db.SyncResolving+=1,db.Events=db.Events||{}),obj.name=id,obj},this.Sync.__proto__={},this.Sync.__proto__.stable=function(id,db,then){NimoDB.table?attr.table.init(NimoDB.table).openTable(id).then((function(e){e?then(e):attr.table.init(NimoDB.table).createTable(id).then(then)})):_this.openDatabase(SynNAME).then((function(e){e?(NimoDB.table=e,e.openTable(id).then((function(e){e?then(e):NimoDB.table.createTable(id).then((function(e){then(e)}))}))):_this.createDatabase(SynNAME).then((function(e){NimoDB.table=e,e.createTable(id).then((function(_e){_e?then(_e):e.openTable(id).then(then)}))}))}))},this.Sync.__proto__.unstable=function(id,db,then){function frh(name,version,tables,e){if(version+=1,tables.contains(id)){if(e)return e=(e=e.transaction(id,"readwrite")).objectStore(id),void new frh.init(e);attr.indexedDB.open(nimoName(SynNAME)).onsuccess=function(e){e=(e=(e=e.target.result).transaction(id,"readwrite")).objectStore(id),new frh.init(e)}}else attr.indexedDB.open(nimoName(SynNAME),version).onupgradeneeded=function(e){e=e.target.result;for(var i=0;_this.Sync.STORE_MODE.length>i;i++)i+1===_this.Sync.STORE_MODE.length?e=e.createObjectStore(_this.Sync.STORE_MODE[i],{keyPath:keyPath}):e.createObjectStore(_this.Sync.STORE_MODE[i],{keyPath:keyPath});new frh.init(e)}}frh.init=function(e){if(e.transaction.db){var _e=e;e={transaction:function(){return{objectStore:function(){return _e}}}}}e.close=new Function,then(new attr.row(e,id))},attr.indexedDB.open(nimoName(SynNAME)).onsuccess=function(_e){_e=_e.target.result,attr.version=_e.version,_e.version<=1?attr.indexedDB.open(nimoName(_name)).onsuccess=function(e){(e=(e=e.target.result).transaction(def,"readwrite")).oncomplete=function(){_e.close(),frh(_e.name,_e.version,_e.objectStoreNames)};var obj={};obj[keyPath]=SynNAME,obj.value={name:SynNAME,info:time()},e.objectStore(def).add(obj).onsuccess=function(){try{e.db.close()}catch(e){e.db.transaction.db.close()}}}:frh(_e.name,_e.version,_e.objectStoreNames,_e)}},this.Sync.STORE_MODE=[new String("Sync storage"),new String("Sync storage(2)")],this.createDatabase=function(){var name=arguments[0],name=nimoName(name),f=null,rst=new Promise((function(r){_this.getAllCreatedDatabase().then((function(e){if(has(e,name))NimoDB.__proto__.console.error(`can not create database:\n "${decode(name)}" already exist`),r(null);else{var fx=attr.indexedDB.open(name);fx.onsuccess=function(){(fx=fx.result).close(),_this.open(_name,def).then((function(e){e.setItem(decode(fx.name),{name:decode(fx.name),info:time()}).then((function(e){r(new attr.table(fx.name,fx.version,fx.objectStoreNames))}))}))}}}))}));return rst},this.openDatabase=function(){var name=arguments[0],$t=arguments[2],name=nimoName(name),rst=new Promise((function(r){var dnm=decode(name);var fx=attr.indexedDB.open(name);fx.onsuccess=function(){(fx=fx.result).close(),r(new attr.table(fx.name,fx.version,fx.objectStoreNames))}}));return rst},this.getAllCreatedDatabase=function(){var prm;return new Promise((function(r){var db;(_this||new attr(_name)).open(_name,def).then((function(e){e?e.getAllItem().then((function(e){r(e)})):r({})}))}))},this.deleteAllCreatedDatabase=function(){var prm;return new Promise((function(r){_this.getAllCreatedDatabase().then((function(e){var done="no database";for(var prop in e){var name=e[prop].name;name=nimoName(name),done="done",attr.indexedDB.deleteDatabase(name)}_this.open(_name,def).then((function(e){e.clear().then((function(e){r(done)}))}))}))}))},this.deleteDatabase=function(){var name=arguments[0],prm=new Promise((function(r){var d;name=nimoName(name),attr.indexedDB.deleteDatabase(name).onsuccess=function(e){_this.open(_name,def).then((function(e){e.removeItem(decode(name)).then((function(e){r("done")}))}))}}));return prm},this.open=function(db,tb){return db=db,tb=tb,new Promise((function(r){_this.openDatabase(db).then((function(e){r(e?e.openTable(tb):e)}))}))},this.create=function(db,tb){return db=db,tb=tb,new Promise((function(r){_this.createDatabase(db).then((function(e){r(e?e.createTable(tb):e)}))}))},attr.table=function(){var name=arguments[0],vs=arguments[1],tb=arguments[2];vs+=1,this.createTable=function(tb_name,tb_config){var obj={keyPath:keyPath};return new Promise((function(r){tb.contains(tb_name),attr.indexedDB.open(name,vs).onupgradeneeded=function(e){if((e=e.target.result).objectStoreNames.contains(tb_name))return NimoDB.__proto__.console.error(`A table with the name "${tb_name}" already exist. `),r(null),void e.close();$e=e.createObjectStore(tb_name,obj),r(new attr.row(name,tb_name,attr)),e.close()},vs+=1}))},this.openTable=function(tb_name){return new Promise((function(r){tb.contains(tb_name),attr.indexedDB.open(name).onsuccess=function(e){if(!(e=e.target.result).objectStoreNames.contains(tb_name))return NimoDB.__proto__.console.error(`A table with the name "${tb_name}" does not exist. `),r(null),void e.close();e.close(),r(new attr.row(name,tb_name,attr))}}))},this.deleteTable=function(tb_name){return new Promise((function(r){tb.contains(tb_name),attr.indexedDB.open(name,vs).onupgradeneeded=function(e){(e=e.target.result).objectStoreNames.contains(tb_name)?(e.deleteObjectStore(tb_name),e.close(),r("done")):(NimoDB.__proto__.console.error(`A table with the name "${tb_name}" does not exist. `),r(null))}}))},this.getAllTable=function(){return new Promise((function(r){attr.indexedDB.open(name).onsuccess=function(e){(e=e.target.result).close(),e=e.objectStoreNames,r(e)}}))},this.deleteAllTable=function(){return new Promise((function(r){attr.indexedDB.open(name,vs).onupgradeneeded=function(e){for(var objN=(e=e.target.result).objectStoreNames,i=0;i<objN.length;i++)e.deleteObjectStore(objN[i]);e.close(),r("done")}}))}},attr.row=function(){var name=arguments[0],tb_name=arguments[1],$this=this,attr;"object"==typeof name&&name.close?(attr={indexedDB:{}}).indexedDB.open=function(){var obj={};return new Promise((function(r){r()})).then((function(){obj.onsuccess({target:{result:name}})})),obj}:attr=arguments[2],this.setItem=function(key,value){var prm;return new Promise((function(r){attr.indexedDB.open(name).onsuccess=function(e){var $e=e.target.result;(e=$e.transaction(tb_name,"readwrite")).oncomplete=function(){};var obj={},val;obj[keyPath]=key,obj.value=value,(e=e.objectStore(tb_name)).put(obj).onsuccess=function(){try{$e.close()}catch(e){$e.transaction.db.close()}r("done")}}}))},this.removeItem=function(){var $name=arguments[0],prm=new Promise((function(r){attr.indexedDB.open(name).onsuccess=function(e){var $e=e.target.result,val;(e=$e.transaction(tb_name,"readwrite")).oncomplete=function(){},(e=e.objectStore(tb_name)).delete($name).onsuccess=function(){try{$e.close()}catch(e){$e.transaction.db.close()}r("done")}}}));return prm},this.clear=function(){var prm;return new Promise((function(r){attr.indexedDB.open(name).onsuccess=function(e){var $e=e.target.result;(e=$e.transaction(tb_name,"readwrite")).oncomplete=function(){},(e=e.objectStore(tb_name)).clear().onsuccess=function(){try{$e.close()}catch(e){$e.transaction.db.close()}r("done")}}}))},this.has=function($val){var prm;return new Promise((function(r){attr.indexedDB.open(name).onsuccess=function(e){var $e=e.target.result,val;(e=(e=$e.transaction(tb_name,"readonly")).objectStore(tb_name)).openCursor().onsuccess=function(e){var rst=e.target.result;rst?$val===rst.key?($e.close(),r(!0)):rst.continue():($e.close(),r(!1))}}}))},this.keys=function(){var f=arguments[0];f="function"==typeof f?f:new Function;var prm=new Promise((function(r){attr.indexedDB.open(name).onsuccess=function(e){var $e=e.target.result;(e=(e=$e.transaction(tb_name,"readonly")).objectStore(tb_name)).getAllKeys().onsuccess=function(e){r(e.target.result),$e.close()}}}));return prm},this.getAllItemAsArray=function(f){var f;f="function"==typeof(f=arguments[0])?f:new Function;var prm=new Promise((function(r){attr.indexedDB.open(name).onsuccess=function(e){var $e=e.target.result;(e=(e=$e.transaction(tb_name,"readonly")).objectStore(tb_name)).getAll().onsuccess=function(e){r(e.target.result),$e.close()}}}));return prm},this.getAllItem=function(f){var prm;return f="function"==typeof f?f:new Function,new Promise((function(r){attr.indexedDB.open(name).onsuccess=function(e){var $e=e.target.result,val=(e=(e=$e.transaction(tb_name,"readonly")).objectStore(tb_name)).openCursor(),array={};val.onsuccess=function(e){var rst=e.target.result;if(rst){var key=rst.key;f(key,rst.value);var val=nimoOBJ(rst.value);array[key]=val,rst.continue()}else try{$e.close(),r(array)}catch(e){$e.transaction.db.close(),r(array)}}}}))},this.getItem=function(){var $name=arguments[0],prm=new Promise((function(r){attr.indexedDB.open(name).onsuccess=function(e){var $e=e.target.result,val=(e=(e=$e.transaction(tb_name,"readonly")).objectStore(tb_name)).get($name);val.onsuccess=function(){var rst=val.result;rst=nimoOBJ(rst);try{$e.close(),r(rst)}catch(e){$e.transaction.db.close(),r(rst)}}}}));return prm}},attr.table.init=function(e){return e},attr.row.init=function(e){return e},attr.database=[],attr.indexedDB=indexedDB,this.devMode=!0,attr.indexedDB||(attr.indexedDB={open:function(){return{}}});var nimoName=function(x,y){y||x||NimoDB.__proto__.console.error("invalid name");var name=x+tmp;return name="NIMO:"+encode(name)},encode=function(x,y){return y||(x=parseString(x)),x=x[1],x=btoa(x)},decode=function(x,y){return y||(x=parseString(x)),x=x[1],x=(x=atob(x)).substring(0,x.length-tmp.length)},parseString=function(x){var idx=(x=String(x)).indexOf(":"),sub_1,sub_2;return[x.substring(0,idx),x.substring(idx+1,x.length)]},nimoOBJ=function(e){return"object"==typeof e&&(e=e.value),e},time=function(){var obj={};return obj.date=[(new Date).toDateString(),(new Date).toLocaleDateString()],obj.exactDate=Date.now(),obj},has=function(e,name){return decode(name)in e};attr.indexedDB.open(nimoName(_name)).onupgradeneeded=function(e){1===(e=e.target.result).version&&e.createObjectStore(def,{keyPath:keyPath}),e.close()},NimoDB.__proto__.console={error:function(x){_this.devMode&&console.error(x)}},attr.loaded=!0}NimoDB.__proto__={},NimoDB.__proto__.store={},NimoDB.__proto__.Sync=(new NimoDB).Sync,NimoDB.__proto__.Sync=NimoDB.Sync(NimoDB.Sync.STORE_MODE[0],{cache:!0,typeSensitive:!1,filter:function(argument){argument[0]=String(argument[0]).toUpperCase().trim().replace(/\s| /gim,"_"),this.setItem=function(){return!(argument[1]instanceof Blob||argument[1]instanceof File)||(NimoDB.__proto__.console.error("Blob and File type are not supported"),!1)}}});